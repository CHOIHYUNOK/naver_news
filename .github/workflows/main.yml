name: Build with Docker

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      # [해결책] 컴퓨터 환경을 타지 않는 '도커(Docker)' 안에서 빌드합니다.
      # 이 방법은 Java, Python 버전을 맞출 필요 없이 알아서 다 된 환경을 가져옵니다.
      - name: Build APK with Docker
        uses: docker://kivy/buildozer:latest
        with:
          # 약관 동의와 상세 로그(-v)를 포함한 빌드 명령어
          args: buildozer -v android debug

      # 도커가 만든 파일의 권한을 내 것으로 가져오기 (이게 없으면 업로드 실패함)
      - name: Fix Permissions
        run: |
          sudo chown -R $USER:$USER bin

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: package
          path: bin/*.apk
